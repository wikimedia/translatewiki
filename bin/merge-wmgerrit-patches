#!/bin/bash
set -o nounset -o pipefail -o errexit

U="L10n-bot <l10n-bot@translatewiki.net>"
GERRIT=("l10n-bot@gerrit.wikimedia.org" -p 29418)

ssh "${GERRIT[@]}" gerrit query --format=TEXT "owner:$U" "project:$1" status:open |
(grep -Po '(?<=^  number: )[0-9]+$' || true) | # Handle pipefail from grep
sort |
xargs -I ____ ssh "${GERRIT[@]}" gerrit review ____,1 --code-review 2
